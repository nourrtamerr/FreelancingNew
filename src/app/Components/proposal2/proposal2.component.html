<div class="upwork-job-container py-4">
  <div class="container">
    <div class="row gx-4 gy-4">
      <div class="col-lg-12 col-md-12">
        <div class="upwork-job-details mb-4">
          <h1 class="job-title">Submit a proposal</h1>

          <!-- Project Summary Section -->
          <div class="proposal-summary-card" *ngIf="project">
            <h2 class="proposal-summary-title">{{project.title}}</h2>
            <div class="proposal-summary-list mt-5">
              <div class="proposal-summary-item">
                <i class="fa fa-tag"></i>
                <span class="proposal-summary-label">Project Type:</span>
                <span class="proposal-summary-value">{{projectType}} project</span>
              </div>
              <div class="proposal-summary-item">
                <i class="fa-solid fa-dollar-sign"></i>
                <span class="proposal-summary-label">Price:</span>
                <span class="proposal-summary-value">
                  {{projectType === 'Bidding' ? (project.minimumPrice + ' - ' + project.maximumPrice) : project.price}}
                </span>
              </div>
              <div class="proposal-summary-item">
                <i class="fa-regular fa-clock"></i>
                <span class="proposal-summary-label">Expected Duration:</span>
                <span class="proposal-summary-value">{{project.expectedDuration}} Days</span>
              </div>
              <div class="proposal-summary-item" *ngIf="projectType === 'Bidding'">
                <i class="fa-solid fa-hourglass"></i>
                <span class="proposal-summary-label">Bid End Date:</span>
                <span class="proposal-summary-value">{{project.biddingEndDate | date:'mediumDate'}}</span>
              </div>
            </div>
          </div>

          <!-- Cover Letter Section -->
          <div class="proposal-details-card">
            <form #proposalForm="ngForm">
              <div class="proposal-details-group">
                <label for="coverLetter" class="proposal-details-label">Cover Letter*</label>
                <textarea
                  [(ngModel)]="proposal.coverLetter"
                  name="coverLetter"
                  id="coverLetter"
                  class="proposal-details-textarea"
                  [class.is-invalid]="hasError('coverLetter')"
                  rows="8"
                  required></textarea>
                <div *ngIf="hasError('coverLetter')" class="text-danger small mt-1">
                  {{ getError('coverLetter') }}
                </div>
              </div>
            </form>
          </div>

          <!-- Milestones Section -->
          <div class="proposal-terms-card">
            <h2 class="proposal-terms-title">Milestones*</h2>
            
            <div class="proposal-milestone-section">
              <ng-container *ngFor="let milestone of proposal.suggestedMilestones; let i = index">
                <div class="proposal-milestone-table milestone-bordered" style="position: relative;">
                  <!-- Remove button -->
                  <button *ngIf="i > 0"
                          type="button"
                          class="milestone-remove-btn"
                          (click)="removeMilestone(i)"
                          title="Remove milestone">
                    &times;
                  </button>
                  
                  <div class="proposal-milestone-table-row milestone-custom-row">
                    <div class="milestone-description-col">
                      <label class="proposal-milestone-label">Description*</label>
                      <textarea
                        [(ngModel)]="milestone.description"
                        [name]="'milestone-description-' + i"
                        class="proposal-milestone-description"
                        [class.is-invalid]="hasError('description', i)"
                        placeholder="Milestone description"
                        required></textarea>
                      <div *ngIf="hasError('description', i)" class="text-danger small mt-1">
                        {{ getError('description', i) }}
                      </div>
                    </div>
                    <div class="milestone-right-col">
                      <div>
                        <label class="proposal-milestone-label">Title*</label>
                        <input [(ngModel)]="milestone.title"
                               [name]="'milestone-title-' + i"
                               type="text"
                               class="proposal-milestone-input"
                               [class.is-invalid]="hasError('title', i)"
                               placeholder="Milestone title"
                               required>
                        <div *ngIf="hasError('title', i)" class="text-danger small mt-1">
                          {{ getError('title', i) }}
                        </div>
                      </div>
                      <div class="milestone-bottom-row">
                        <div style="flex:1;">
                          <label class="proposal-milestone-label">Price*</label>
                          <input [(ngModel)]="milestone.amount"
                                 [name]="'milestone-amount-' + i"
                                 type="number"
                                 class="proposal-milestone-input"
                                 [class.is-invalid]="hasError('amount', i)"
                                 placeholder="$0.00"
                                 min="0.01"
                                 step="0.01"
                                 required>
                          <div *ngIf="hasError('amount', i)" class="text-danger small mt-1">
                            {{ getError('amount', i) }}
                          </div>
                        </div>
                        <div style="flex:1;">
                          <label class="proposal-milestone-label">Duration (days)*</label>
                          <input [(ngModel)]="milestone.duration"
                                 [name]="'milestone-due-' + i"
                                 type="number"
                                 class="proposal-milestone-input"
                                 [class.is-invalid]="hasError('duration', i)"
                                 placeholder="Duration"
                                 min="1"
                                 required>
                          <div *ngIf="hasError('duration', i)" class="text-danger small mt-1">
                            {{ getError('duration', i) }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

              <!-- Add Milestone Button -->
              <button type="button" 
                      class="proposal-milestone-add-btn" 
                      (click)="addMilestone()">
                + Add milestone
              </button>
            </div>
          </div>

          <!-- Submit Button Section -->
          <div class="proposal-submit-actions pt-4">
            <button class="proposal-send-btn" 
                    (click)="createProposal(proposalForm)"
                    [disabled]="!validateForm() || isSubmitting">
              <span *ngIf="!isSubmitting">Apply proposal</span>
              <span *ngIf="isSubmitting">Submitting...</span>
            </button>
            <button type="button" class="proposal-cancel-link">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>