<div class="milestones-container">
  <div class="milestones-header">
    <h1>Project Milestones</h1>
    <div class="milestone-progress">
      <div class="progress-stats">
        <div class="stat-item">
          <span class="stat-value">{{milestones.length}}</span>
          <span class="stat-label"> Total Milestones</span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="milestones-timeline;" *ngIf="milestones.length > 0">
    <div class="milestone-card" *ngFor="let milestone of milestones; let i = index">
      
      <div class="milestone-content">
        <div class="milestone-header">
          <h3>{{milestone.title}}</h3>
          <span 
          class="milestone-status"
          [ngClass]="{
            'Completed': milestone.status === 1,
            'in-progress': milestone.status === 0
          }">
          {{ getStatusText(milestone.status) }}
        </span>
        
        </div>


        <!-- Add buttons based on user role -->
  <div class="milestone-actions" *ngIf="milestone.status === 0">
    <button *ngIf="isProjectClient && milestone.status === 0 && isFirstPendingMilestone(milestone)" 
          class="btn btn-success" 
          (click)="confirmMilestone(milestone.id??0)">
    <i class="fa fa-check"></i> Confirm Milestone
  </button>
    
    <div class="file-upload-section" *ngIf="isProjectFreelancer">
      <input type="file" 
             #fileInput 
             (change)="onFileSelected($event, milestone.id??0)" 
             multiple 
             style="display: none;">
      <button class="btn btn-primary upload-btn" 
              (click)="fileInput.click()">
        <i class="fas fa-upload"></i> Upload Files
      </button>
    </div>
  </div>
        <div class="milestone-info">
          <p class="description">{{milestone.description}}</p>
          <div class="milestone-details">
            <div class="detail">
              <i class="fas fa-calendar-alt"></i>
              <span>Start: {{milestone.startDate | date}}</span>
            </div>
            <div class="detail">
              <i class="fas fa-flag-checkered"></i>
              <span>Due: {{milestone.endDate | date}}</span>
            </div>
            <div class="detail">
              <span>Amount: ${{milestone.amount}}</span>
            </div>
            
          </div> 
        </div>


        <div class="milestone-files" *ngIf="milestone.files && milestone.files.length > 0">
          <h4>Attachments</h4>
          <div class="file-list">
            <div class="file-container" *ngFor="let file of milestone.files">
              <ng-container [ngSwitch]="getFileType(file)">
                <!-- Image files -->
                <div class="file-preview">
                  <img *ngSwitchCase="'image'" [src]="file" alt="Milestone Image" class="milestone-image">
                  <button *ngIf="isProjectFreelancer" 
                          class="delete-btn" 
                          (click)="deleteFile( file)">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
            
                <!-- Video files -->
                <div class="file-preview">
                  <video *ngSwitchCase="'video'" [src]="file" controls></video>
                  <button *ngIf="isProjectFreelancer" 
                          class="delete-btn" 
                          (click)="deleteFile( file)">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
            
                <!-- Other files -->
                <div *ngSwitchDefault class="file-preview">
                  <a [href]="file" target="_blank">
                    <i class="fa fa-file"></i> Download File
                  </a>
                  <button *ngIf="isProjectFreelancer" 
                          class="delete-btn" 
                          (click)="deleteFile( file)">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
        
        
    
    </div>

  </div>

  <div class="empty-state" *ngIf=" milestones.length === 0">
    <i class="fas fa-clipboard-list"></i>
    <h2>No Milestones Found</h2>
    <p>This project doesn't have any milestones yet.</p>
  </div>
</div>