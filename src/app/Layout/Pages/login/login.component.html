<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow border-0">
        <!-- Card Header with Tabs -->
        <div class="card-header bg-white border-bottom-0">
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <a class="nav-link" [class.active]="currentForm === 'login'" (click)="showLogin()" href="javascript:void(0);">
                <i class="fas fa-sign-in-alt me-2"></i>Login
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" [class.active]="currentForm === 'forgotPassword'" (click)="showForgotPasswordView()" href="javascript:void(0);">
                <i class="fas fa-key me-2"></i>Forgot Password
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" [class.active]="currentForm === 'resetPassword'" href="javascript:void(0);" [class.d-none]="!emailFromQuery">
                <i class="fas fa-lock me-2"></i>Reset Password
              </a>
            </li>
          </ul>
        </div>

        <div class="card-body p-4">
          <!-- Login Form -->
          <form *ngIf="currentForm === 'login'" [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="needs-validation">
            <h3 class="mb-4 text-center">Welcome Back</h3>
            
            <div class="form-floating mb-3">
              <input 
                type="text"
                id="usernameEmail"
                class="form-control" 
                placeholder="Email or Username"
                formControlName="Usernameoremail"
                [class.is-invalid]="loginForm.get('Usernameoremail')?.invalid && loginForm.get('Usernameoremail')?.touched"
              />
              <label for="usernameEmail">Email or Username</label>
              <div class="invalid-feedback">
                Username or email is required
              </div>
            </div>
            
            <div class="form-floating mb-3">
              <input 
                type="password"
                id="loginPassword" 
                class="form-control" 
                placeholder="Password"
                formControlName="loginPassword"
                [class.is-invalid]="loginForm.get('loginPassword')?.invalid && loginForm.get('loginPassword')?.touched"
              />
              <label for="loginPassword">Password</label>
              <div class="invalid-feedback">
                Password is required and must be at least 6 characters
              </div>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="rememberMe">
              <label class="form-check-label" for="rememberMe">
                Keep me logged in
              </label>
            </div>
            
            <div *ngIf="errorMessage && currentForm === 'login'" class="alert alert-danger">
              <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
            </div>
            
            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-primary btn-lg" [disabled]="isLoading || loginForm.invalid">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                {{ isLoading ? "Logging in..." : "Login" }}
              </button>
            </div>

            <div class="text-center mb-4">
              <a href="javascript:void(0);" (click)="showForgotPasswordView()" class="text-decoration-none">
                Forgot password?
              </a>
            </div>
            
            <div class="divider d-flex align-items-center my-4">
              <span class="mx-3 text-muted">OR CONTINUE WITH</span>
            </div>
            
            <!-- Social Login Buttons -->
            <div class="d-flex justify-content-center gap-3 mb-3">
              <button type="button" (click)="ExternalLogin('Google')" class="btn btn-outline-danger">
                <i class="fab fa-google me-2"></i>Google
              </button>
              <button type="button" (click)="ExternalLogin('Facebook')" class="btn btn-outline-primary">
                <i class="fab fa-facebook-f me-2"></i>Facebook
              </button>
            </div>
            
            <div class="text-center mt-4">
              <span class="text-muted">Don't have an account?</span>
              <a routerLink="/register" class="ms-2 fw-bold text-decoration-none">Sign Up</a>
            </div>
          </form>

          <!-- Forgot Password Form -->
          <form *ngIf="currentForm === 'forgotPassword'" [formGroup]="forgetPassword" class="needs-validation">
            <h3 class="mb-4 text-center">Recover Your Password</h3>
            <p class="text-muted text-center mb-4">Enter your email address and we'll send you a link to reset your password.</p>
            
            <div class="form-floating mb-3">
              <input 
                type="email"
                id="forgotEmail"
                class="form-control" 
                placeholder="Enter Your Email"
                formControlName="email"
                [class.is-invalid]="forgetPassword.get('email')?.invalid && forgetPassword.get('email')?.touched"
              />
              <label for="forgotEmail">Email Address</label>
              <div class="invalid-feedback">
                <div *ngIf="forgetPassword.get('email')?.errors?.['required']">Email is required.</div>
                <div *ngIf="forgetPassword.get('email')?.errors?.['email']">Invalid email format.</div>
              </div>
            </div>
            
            <div *ngIf="errorMessage && currentForm === 'forgotPassword'" class="alert alert-danger">
              <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
            </div>
            
            <div class="d-grid mb-4">
              <button type="button" (click)="getPassword()" class="btn btn-primary btn-lg" [disabled]="isLoading || forgetPassword.invalid">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                {{ isLoading ? "Sending..." : "Send Reset Link" }}
              </button>
            </div>
            
            <div class="text-center">
              <a href="javascript:void(0);" (click)="showLogin()" class="text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i>Back to Login
              </a>
            </div>
          </form>

          <!-- Reset Password Form -->
          <form *ngIf="currentForm === 'resetPassword'" [formGroup]="resetPassword" class="needs-validation">
            <h3 class="mb-4 text-center">Create New Password</h3>
            <p class="text-muted text-center mb-4">Your new password must be different from previous passwords.</p>
            
            <div class="alert alert-info mb-4">
              <i class="fas fa-info-circle me-2"></i>Resetting password for: <strong>{{ resetPassword.get('email')?.value }}</strong>
            </div>

            <!-- Hidden Fields -->
            <input type="hidden" formControlName="email">
            <input type="hidden" formControlName="token">
            
            <div class="form-floating mb-3">
              <input 
                type="password"
                id="newPassword"
                class="form-control" 
                placeholder="New Password"
                formControlName="newPassword"
                [class.is-invalid]="resetPassword.get('newPassword')?.invalid && resetPassword.get('newPassword')?.touched"
              />
              <label for="newPassword">New Password</label>
              <div class="invalid-feedback">
                <div *ngIf="resetPassword.get('newPassword')?.errors?.['required']">New password is required.</div>
                <div *ngIf="resetPassword.get('newPassword')?.errors?.['minlength']">Password must be at least 8 characters.</div>
                <div *ngIf="resetPassword.get('newPassword')?.errors?.['pattern']">
                  Must include uppercase, lowercase, number, and special character.
                </div>
              </div>
              
              <!-- Password Strength Indicator -->
              <div *ngIf="resetPassword.get('newPassword')?.value" class="mt-2">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small>Password Strength: <span class="fw-bold">{{passwordStrengthText}}</span></small>
                </div>
                <div class="progress" style="height: 5px;">
                  <div class="progress-bar" 
                       [ngClass]="{
                         'bg-danger': passwordStrength <= 2,
                         'bg-warning': passwordStrength === 3,
                         'bg-success': passwordStrength >= 4
                       }"
                       [style.width.%]="passwordStrength * 20">
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-floating mb-3">
              <input 
                type="password"
                id="confirmNewPassword"
                class="form-control" 
                placeholder="Confirm New Password"
                formControlName="confirmNewPassword"
                [class.is-invalid]="(resetPassword.get('confirmNewPassword')?.invalid && resetPassword.get('confirmNewPassword')?.touched) || 
                                   (resetPassword.hasError('mismatch') && resetPassword.get('confirmNewPassword')?.touched)"
              />
              <label for="confirmNewPassword">Confirm New Password</label>
              <div class="invalid-feedback">
                <div *ngIf="resetPassword.get('confirmNewPassword')?.errors?.['required']">Confirm password is required.</div>
                <div *ngIf="resetPassword.hasError('mismatch') && !resetPassword.get('confirmNewPassword')?.errors?.['required']">
                  Passwords do not match.
                </div>
              </div>
            </div>

            <div *ngIf="errorMessage && currentForm === 'resetPassword'" class="alert alert-danger">
              <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
            </div>
            
            <div class="d-grid mb-4">
              <button type="button" (click)="resetPasswordSubmit()" class="btn btn-primary btn-lg" [disabled]="isLoading || resetPassword.invalid">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                {{ isLoading ? "Resetting..." : "Reset Password" }}
              </button>
            </div>
            
            <div class="text-center">
              <a href="javascript:void(0);" (click)="showLogin()" class="text-decoration-none">
                <i class="fas fa-arrow-left me-2"></i>Back to Login
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CSS for the divider -->
<style>
.divider {
  position: relative;
  text-align: center;
}

.divider::before,
.divider::after {
  content: "";
  flex: 1;
  border-bottom: 1px solid #dee2e6;
}

.divider span {
  font-size: 0.75rem;
  letter-spacing: 1px;
}
</style>